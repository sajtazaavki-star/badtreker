<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ë–ê–î-—Ç—Ä–µ–∫–µ—Ä</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // ‚ïê‚ïê –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ò –î–ê–ù–ù–´–ï FIREBASE ‚ïê‚ïê
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  let db;
  try {
    const app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    window._firebaseReady = true;
  } catch(e) {
    window._firebaseReady = false;
  }

  window._fbSave = async (id, data) => {
    if (!window._firebaseReady) return false;
    try { await setDoc(doc(db,"profiles",id), data); return true; } catch(e) { return false; }
  };
  window._fbLoad = async (id) => {
    if (!window._firebaseReady) return null;
    try { const s = await getDoc(doc(db,"profiles",id)); return s.exists()?s.data():null; } catch(e) { return null; }
  };
</script>

<style>
:root {
  --cr:#f4efe6; --wm:#faf7f2;
  --sg:#6b9e6f; --sgl:#a8c9ab; --sgd:#3d6b41;
  --bl:#c97a60; --bll:#f0c4b0;
  --gd:#c9993a; --gdl:#f5dfa0;
  --lv:#8b7ab8; --sk:#5a9fc4;
  --dk:#26201a; --md:#7a6b5e; --mu:#b5a898;
  --cd:rgba(255,255,255,0.72); --br:rgba(200,185,168,0.35);
  --sh:0 4px 24px rgba(38,32,26,0.08); --sh2:0 8px 40px rgba(38,32,26,0.15);
  --r:20px; --rs:12px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',sans-serif;background:var(--cr);color:var(--dk);min-height:100vh;
  background-image:radial-gradient(ellipse at 15% 15%,rgba(107,158,111,.13) 0%,transparent 55%),
  radial-gradient(ellipse at 85% 85%,rgba(201,122,96,.10) 0%,transparent 55%)}

/* LOCK */
#ls{position:fixed;inset:0;background:linear-gradient(135deg,#f4efe6,#e8dfd3);z-index:2000;display:flex;align-items:center;justify-content:center}
.lw{background:rgba(255,255,255,.82);backdrop-filter:blur(16px);border:1.5px solid rgba(255,255,255,.9);border-radius:28px;padding:40px 36px;width:340px;box-shadow:var(--sh2);text-align:center}
.lt{font-family:'Playfair Display',serif;font-size:26px;margin-bottom:6px}.lt span{color:var(--sg)}
.ls2{font-size:14px;color:var(--md);margin-bottom:24px}
.lav{width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--bll),var(--sgl));display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:28px;font-weight:700;margin:0 auto 16px;color:var(--dk)}
.lpn{font-family:'Playfair Display',serif;font-size:20px;margin-bottom:4px}
.lpm{font-size:13px;color:var(--md);margin-bottom:22px}
.pdots{display:flex;justify-content:center;gap:12px;margin-bottom:18px}
.pd{width:14px;height:14px;border-radius:50%;border:2px solid var(--mu);background:transparent;transition:all .2s}
.pd.on{background:var(--sg);border-color:var(--sg)}
.pgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.pb{padding:15px;border-radius:var(--rs);border:1.5px solid var(--br);background:rgba(255,255,255,.7);font-family:'DM Sans',sans-serif;font-size:20px;font-weight:600;cursor:pointer;transition:all .15s;color:var(--dk)}
.pb:hover{background:var(--sg);color:white;border-color:var(--sg);transform:scale(1.05)}
.pb.del{background:rgba(201,122,96,.1);border-color:transparent;color:var(--bl)}
.pb.del:hover{background:var(--bl);color:white}
.perr{color:var(--bl);font-size:13px;margin-top:10px;height:20px}
.lprofs{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:20px}
.lpc{padding:8px 16px;border-radius:40px;background:rgba(255,255,255,.7);border:1.5px solid var(--br);cursor:pointer;font-size:13px;font-weight:500;transition:all .2s}
.lpc:hover{border-color:var(--sg);color:var(--sgd)}
.lpc.sel{background:var(--sg);color:white;border-color:var(--sg)}

/* HEADER */
header{background:rgba(244,239,230,.88);backdrop-filter:blur(14px);border-bottom:1px solid var(--br);padding:0 24px;position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;height:62px}
.logo{font-family:'Playfair Display',serif;font-size:21px;letter-spacing:-.5px}.logo span{color:var(--sg)}
#hr{display:flex;align-items:center;gap:8px}
.sync-btn{font-size:12px;padding:6px 11px;border-radius:20px;border:1.5px solid var(--br);background:transparent;cursor:pointer;color:var(--md);transition:all .2s;display:flex;align-items:center;gap:5px}
.sync-btn:hover{border-color:var(--sg);color:var(--sgd)}
.sync-btn.ok{color:var(--sg);border-color:var(--sgl)}
.sync-btn.err{color:var(--bl);border-color:var(--bll)}
.pchips{display:flex;gap:6px}
.pchip{display:flex;align-items:center;gap:7px;background:var(--cd);border:1.5px solid var(--br);border-radius:40px;padding:5px 12px 5px 7px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s}
.pchip:hover{border-color:var(--sg)}
.pchip.act{background:var(--sg);color:white;border-color:var(--sg)}
.chav{width:28px;height:28px;border-radius:50%;background:var(--bll);color:var(--bl);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0}
.pchip.act .chav{background:rgba(255,255,255,.25);color:white}
.addbtn{width:34px;height:34px;border-radius:50%;border:1.5px dashed var(--mu);background:transparent;cursor:pointer;font-size:20px;color:var(--mu);transition:all .2s;display:flex;align-items:center;justify-content:center}
.addbtn:hover{border-color:var(--sg);color:var(--sg)}

/* NAV */
nav{display:flex;gap:3px;padding:14px 24px 0;overflow-x:auto;scrollbar-width:none}
nav::-webkit-scrollbar{display:none}
.tab{padding:9px 17px;border-radius:40px 40px 0 0;background:rgba(255,255,255,.35);border:1.5px solid rgba(200,185,168,.2);border-bottom:none;cursor:pointer;font-size:13px;font-weight:500;color:var(--md);white-space:nowrap;transition:all .2s}
.tab:hover{background:rgba(255,255,255,.55)}
.tab.act{background:var(--wm);color:var(--dk);font-weight:600;border-color:var(--br)}

/* MAIN */
main{padding:0 24px 60px;max-width:1100px;margin:0 auto}
.page{display:none}.page.act{display:block}
.phdr{padding:26px 0 18px;display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:12px;border-bottom:1px solid var(--br);margin-bottom:22px}
.phdr h2{font-family:'Playfair Display',serif;font-size:25px}
.phdr p{font-size:13px;color:var(--md);margin-top:3px}

/* CARD */
.card{background:var(--cd);backdrop-filter:blur(8px);border:1.5px solid rgba(255,255,255,.85);border-radius:var(--r);padding:22px;box-shadow:var(--sh);margin-bottom:18px}
.ctitle{font-family:'Playfair Display',serif;font-size:17px;margin-bottom:16px;display:flex;align-items:center;gap:9px}
.ctitle .ic{font-size:20px}

/* DATE NAV */
.dnav{display:flex;align-items:center;gap:10px;background:var(--cd);border:1.5px solid rgba(255,255,255,.85);border-radius:var(--r);padding:12px 18px;box-shadow:var(--sh);margin-bottom:18px}
.dnav button{width:34px;height:34px;border-radius:50%;border:1.5px solid var(--br);background:white;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;color:var(--md);transition:all .2s}
.dnav button:hover{border-color:var(--sg);color:var(--sgd)}
.ddisp{flex:1;text-align:center}
.dbig{font-family:'Playfair Display',serif;font-size:22px;font-weight:700}
.dsub{font-size:12px;color:var(--md);margin-top:1px}

/* TIME CARDS */
.tgrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:14px;margin-bottom:18px}
.tc{background:var(--cd);border:1.5px solid rgba(255,255,255,.85);border-radius:var(--r);padding:18px;box-shadow:var(--sh);position:relative;overflow:hidden}
.tc::before{content:'';position:absolute;top:0;left:0;right:0;height:4px}
.tc.mg::before{background:linear-gradient(90deg,#f9c846,#f5a623)}
.tc.af::before{background:linear-gradient(90deg,var(--sg),var(--sgd))}
.tc.ev::before{background:linear-gradient(90deg,#9b7ec8,#6e44a8)}
.tlbl{font-size:12px;font-weight:700;letter-spacing:1.4px;text-transform:uppercase;margin-bottom:14px;display:flex;align-items:center;gap:7px}
.tc.mg .tlbl{color:#c4820a}.tc.af .tlbl{color:var(--sgd)}.tc.ev .tlbl{color:#6e44a8}
.si{display:flex;align-items:center;gap:8px;padding:9px 10px;border-radius:var(--rs);background:rgba(255,255,255,.6);margin-bottom:7px;transition:all .2s}
.si:hover{background:rgba(255,255,255,.95);box-shadow:var(--sh)}
.sl{display:flex;align-items:center;gap:8px;flex:1;min-width:0}
.fb{font-size:10px;padding:2px 7px;border-radius:20px;font-weight:700;letter-spacing:.4px;white-space:nowrap;flex-shrink:0}
.fb.capsule{background:#dde8ff;color:#3a5bd9}.fb.tablet{background:#fff0dd;color:#c47a0a}
.fb.powder{background:#e8f5e9;color:#2e7d32}.fb.drops{background:#fce4ec;color:#c2185b}
.fb.other{background:#f3e5f5;color:#7b1fa2}
.sn{font-size:13px;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.sq{font-size:12px;color:var(--md);white-space:nowrap}
.ck{width:32px;height:32px;border-radius:50%;border:2px solid var(--br);background:transparent;cursor:pointer;font-size:15px;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
.ck.on{background:var(--sg);border-color:var(--sg);color:white}
.ck:hover:not(.on){border-color:var(--sg)}
.rb{background:none;border:none;cursor:pointer;font-size:16px;color:var(--mu);padding:2px 4px;transition:color .2s;flex-shrink:0}
.rb:hover{color:var(--bl)}
.asbtn{width:100%;padding:9px;border-radius:var(--rs);border:1.5px dashed rgba(181,169,154,.4);background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:12px;color:var(--md);transition:all .2s;display:flex;align-items:center;justify-content:center;gap:5px;margin-top:3px}
.asbtn:hover{border-color:var(--sg);color:var(--sgd);background:rgba(107,158,111,.05)}

/* MOLODETS */
.mol-card{background:linear-gradient(135deg,rgba(201,153,58,.08),rgba(245,223,160,.15));border-color:rgba(201,153,58,.25)}
.mtrack{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:4px}
.mc{width:44px;height:52px;border-radius:10px;border:2px solid var(--br);background:rgba(255,255,255,.5);display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--mu);transition:all .4s;position:relative}
.mc.un{background:linear-gradient(135deg,var(--gdl),var(--gd));border-color:var(--gd);color:white;box-shadow:0 4px 16px rgba(201,153,58,.35);transform:scale(1.06)}
.mc.cur{border-color:var(--gd);background:rgba(245,223,160,.4);color:var(--gd);animation:pgold 1.8s infinite}
@keyframes pgold{0%,100%{box-shadow:0 0 0 0 rgba(201,153,58,.3)}50%{box-shadow:0 0 0 6px rgba(201,153,58,0)}}
.sinfo{font-size:13px;color:var(--md);margin-top:12px}
.sinfo strong{color:var(--gd)}
.sreset{font-size:12px;color:var(--bl);margin-top:4px}

/* WATER */
.wrow{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.wnum{font-family:'Playfair Display',serif;font-size:30px;font-weight:700;color:var(--sk)}
.wlbl{font-size:11px;color:var(--md)}
.glasses{display:flex;gap:5px;flex-wrap:wrap}
.gl{width:34px;height:42px;border-radius:4px 4px 8px 8px;border:2px solid rgba(90,159,196,.3);background:rgba(210,235,248,.3);cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.gl.on{background:linear-gradient(to top,rgba(70,144,196,.7),rgba(110,185,225,.4));border-color:var(--sk)}
.gl::after{content:'üíß';position:absolute;bottom:3px;left:50%;transform:translateX(-50%);font-size:14px;opacity:0;transition:opacity .2s}
.gl.on::after{opacity:1}
.winp{display:flex;align-items:center;gap:8px;margin-top:12px;flex-wrap:wrap}
.winp input{width:90px;padding:8px 11px;border-radius:var(--rs);border:1.5px solid var(--br);background:white;font-family:'DM Sans',sans-serif;font-size:13px}
.winp input:focus{outline:none;border-color:var(--sk)}

/* BUTTONS */
.btn{padding:9px 18px;border-radius:40px;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;transition:all .2s;display:inline-flex;align-items:center;gap:5px}
.bp{background:var(--sg);color:white}.bp:hover{background:var(--sgd);box-shadow:0 4px 14px rgba(61,107,65,.3)}
.bs{background:rgba(181,169,154,.18);color:var(--md)}.bs:hover{background:rgba(181,169,154,.32)}
.bd{background:rgba(201,122,96,.1);color:var(--bl)}.bd:hover{background:rgba(201,122,96,.22)}
.sm{padding:6px 13px;font-size:12px}

/* GRAPH */
.gwrap{overflow-x:auto;padding-bottom:8px}
.gchart{min-width:520px;height:160px;display:flex;align-items:flex-end;gap:3px;padding:16px 0 28px}
.bc{flex:1;min-width:24px;display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer}
.bv{width:100%;border-radius:5px 5px 0 0;transition:height .4s ease;min-height:3px}
.bv.good{background:linear-gradient(to top,var(--sgd),var(--sgl))}.bv.part{background:linear-gradient(to top,var(--gd),var(--gdl))}
.bv.miss{background:linear-gradient(to top,#c0392b,#e57373)}.bv.mt{background:rgba(181,169,154,.2)}
.bl{font-size:9px;font-weight:600;color:var(--md)}
.bdate{font-size:9px;color:var(--mu);transform:rotate(-45deg);white-space:nowrap;margin-top:3px}
.leg{display:flex;gap:14px;flex-wrap:wrap;margin-top:6px}
.li{display:flex;align-items:center;gap:5px;font-size:12px;color:var(--md)}
.ld{width:10px;height:10px;border-radius:3px}

/* DIARY */
.dent{background:rgba(255,255,255,.65);border-radius:var(--rs);padding:16px;margin-bottom:12px;border:1.5px solid rgba(255,255,255,.9);box-shadow:var(--sh)}
.ddlbl{font-size:11px;color:var(--mu);font-weight:600;letter-spacing:.8px;text-transform:uppercase;margin-bottom:10px}
.mgrid{display:flex;gap:8px;margin-bottom:12px}
.mb{flex:1;padding:10px 5px;border-radius:var(--rs);border:1.5px solid var(--br);background:white;cursor:pointer;font-size:22px;text-align:center;transition:all .2s}
.mb:hover{transform:scale(1.1)}.mb.sel{border-color:var(--sg);background:rgba(107,158,111,.1);transform:scale(1.08)}
.mb span{display:block;font-size:10px;color:var(--md);font-weight:600;margin-top:3px}
.srow{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.slbl{font-size:12px;color:var(--md);min-width:80px;font-weight:500}
.sdots{display:flex;gap:4px}
.sd{width:28px;height:28px;border-radius:50%;border:2px solid var(--br);background:white;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--mu);transition:all .15s}
.sd:hover{border-color:var(--sg);color:var(--sgd)}.sd.sel{background:var(--sg);border-color:var(--sg);color:white}
.swrap{margin-bottom:12px}
.swlbl{font-size:12px;color:var(--md);font-weight:600;margin-bottom:8px;letter-spacing:.5px;text-transform:uppercase}
.schips{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}
.sc{padding:5px 12px;border-radius:20px;border:1.5px solid var(--br);background:white;cursor:pointer;font-size:12px;font-weight:500;transition:all .2s;color:var(--md)}
.sc:hover{border-color:var(--bl);color:var(--bl)}.sc.sel{background:var(--bll);border-color:var(--bl);color:#8a3a1f}
.scust{display:flex;gap:6px}
.scust input{flex:1;padding:6px 11px;border-radius:20px;border:1.5px solid var(--br);background:white;font-family:'DM Sans',sans-serif;font-size:12px}
.scust input:focus{outline:none;border-color:var(--bl)}
.dnote{width:100%;min-height:80px;border-radius:var(--rs);border:1.5px solid var(--br);padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:13px;resize:vertical;background:white;color:var(--dk);line-height:1.5}
.dnote:focus{outline:none;border-color:var(--sg)}
.dhi{background:rgba(255,255,255,.6);border-radius:var(--rs);padding:14px 16px;margin-bottom:10px;border:1.5px solid rgba(255,255,255,.85);cursor:pointer;transition:all .2s}
.dhi:hover{box-shadow:var(--sh);background:white}
.dht{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.dhd{font-size:12px;color:var(--md);font-weight:600}.dhm{font-size:20px}
.dhtxt{font-size:13px;color:var(--md);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dhtags{display:flex;gap:5px;flex-wrap:wrap;margin-top:5px}
.mt{font-size:10px;padding:2px 8px;border-radius:10px;background:var(--bll);color:#8a3a1f;font-weight:500}

/* PROFILES */
.pgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
.pc{background:var(--cd);border:1.5px solid rgba(255,255,255,.85);border-radius:var(--r);padding:22px;box-shadow:var(--sh);text-align:center;transition:all .2s}
.pc:hover{box-shadow:var(--sh2);transform:translateY(-2px)}.pc.iact{border-color:var(--sg)}
.bav{width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,var(--bll),var(--sgl));display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:24px;font-weight:700;margin:0 auto 12px;color:var(--dk)}
.pname{font-family:'Playfair Display',serif;font-size:17px;margin-bottom:3px}
.pmeta{font-size:12px;color:var(--md)}
.pac{display:flex;gap:7px;justify-content:center;margin-top:14px}
.apc{border-style:dashed;border-color:rgba(181,169,154,.4);background:rgba(255,255,255,.3);cursor:pointer}
.apc:hover{border-color:var(--sg)}.apc .bav{background:rgba(181,169,154,.12);font-size:28px;color:var(--mu)}
.apc .pname{color:var(--md)}

/* SUPP MANAGE */
.sr{display:flex;align-items:center;gap:10px;padding:12px 14px;border-radius:var(--rs);background:rgba(255,255,255,.6);margin-bottom:7px;transition:all .2s}
.sr:hover{background:white;box-shadow:var(--sh)}
.sri{flex:1}.sri .sn2{font-weight:600;font-size:14px}.sri .sd2{font-size:12px;color:var(--md);margin-top:2px}

/* MODAL */
.mbg{position:fixed;inset:0;background:rgba(38,32,26,.5);backdrop-filter:blur(5px);z-index:500;display:none;align-items:center;justify-content:center;padding:20px}
.mbg.open{display:flex}
.modal{background:var(--wm);border-radius:var(--r);padding:26px;width:100%;max-width:420px;box-shadow:0 20px 60px rgba(38,32,26,.25);animation:slu .22s ease}
.modal.wide{max-width:480px}
@keyframes slu{from{transform:translateY(28px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal h3{font-family:'Playfair Display',serif;font-size:20px;margin-bottom:18px}
.fg{margin-bottom:13px}
.fg label{display:block;font-size:11px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;color:var(--md);margin-bottom:5px}
.fg input,.fg select{width:100%;padding:9px 13px;border-radius:var(--rs);border:1.5px solid var(--br);background:white;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--dk);transition:border-color .2s}
.fg input:focus,.fg select:focus{outline:none;border-color:var(--sg)}
.fr{display:flex;gap:10px}.fr .fg{flex:1}
.ma{display:flex;gap:8px;justify-content:flex-end;margin-top:18px}
.empty{text-align:center;padding:36px 20px;color:var(--mu)}
.empty .em{font-size:36px;margin-bottom:10px}.empty p{font-size:13px}
@media(max-width:600px){header,nav{padding-left:14px;padding-right:14px}main{padding:0 14px 60px}.tgrid{grid-template-columns:1fr}.mgrid{gap:5px}}
</style>
</head>
<body>

<!-- LOCK SCREEN -->
<div id="ls">
  <div class="lw">
    <div class="lt">–±–∞–¥<span>—Ç—Ä–µ–∫–µ—Ä</span></div>
    <div class="ls2" id="ls2">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</div>
    <div id="lnp" style="display:none">
      <div style="font-size:48px;margin:10px 0">üåø</div>
      <p style="font-size:14px;color:var(--md);margin-bottom:20px">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å</p>
      <button class="btn bp" onclick="lockBypass()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
    </div>
    <div id="lsel">
      <div class="lprofs" id="lprofs"></div>
      <div id="lpins" style="display:none">
        <div class="lav" id="lav">?</div>
        <div class="lpn" id="lpn"></div>
        <div class="lpm" id="lpm"></div>
        <div class="pdots">
          <div class="pd" id="pd0"></div><div class="pd" id="pd1"></div>
          <div class="pd" id="pd2"></div><div class="pd" id="pd3"></div>
        </div>
        <div class="pgrid" id="pgrid"></div>
        <div class="perr" id="perr"></div>
        <button class="btn bs sm" style="margin-top:10px" onclick="lockBack()">‚Üê –ù–∞–∑–∞–¥</button>
      </div>
    </div>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="logo">–±–∞–¥<span>—Ç—Ä–µ–∫–µ—Ä</span></div>
  <div id="hr">
    <button class="sync-btn" id="sb" onclick="syncNow()">
      <span id="si">‚òÅÔ∏è</span><span id="sl">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</span>
    </button>
    <div class="pchips" id="pchips"></div>
    <button class="addbtn" onclick="om('mp')" title="–î–æ–±–∞–≤–∏—Ç—å">+</button>
  </div>
</header>

<nav>
  <div class="tab act" onclick="sp('pt',this)">üìÖ –°–µ–≥–æ–¥–Ω—è</div>
  <div class="tab" onclick="sp('ps',this)">üíä –ë–ê–î—ã</div>
  <div class="tab" onclick="sp('pd',this)">üìì –î–Ω–µ–≤–Ω–∏–∫</div>
  <div class="tab" onclick="sp('pg',this)">üìä –ì—Ä–∞—Ñ–∏–∫</div>
  <div class="tab" onclick="sp('pp',this)">üë§ –ü—Ä–æ—Ñ–∏–ª–∏</div>
</nav>

<main>
  <!-- TODAY -->
  <div class="page act" id="pt">
    <div class="phdr">
      <div><h2>–ü—Ä–∏—ë–º –ë–ê–î–æ–≤</h2><p id="tsub">–ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è</p></div>
    </div>
    <div class="dnav">
      <button onclick="cd(-1)">‚Üê</button>
      <div class="ddisp"><div class="dbig" id="dbig"></div><div class="dsub" id="ddsub"></div></div>
      <button onclick="cd(1)">‚Üí</button>
      <button class="btn bs sm" style="border-radius:12px" onclick="gt()">–°–µ–≥–æ–¥–Ω—è</button>
    </div>
    <div class="card mol-card">
      <div class="ctitle"><span class="ic">üèÜ</span>–¢–µ—Ö–Ω–∏–∫–∞ ¬´–ú–û–õ–û–î–ï–¶¬ª</div>
      <div class="mtrack" id="mt"></div>
      <div class="sinfo" id="msi"></div>
      <div class="sreset" id="msr"></div>
    </div>
    <div class="tgrid">
      <div class="tc mg"><div class="tlbl">‚òÄÔ∏è –£—Ç—Ä–æ</div><div id="sm"></div><button class="asbtn" onclick="oa('morning')">+ –¥–æ–±–∞–≤–∏—Ç—å –ë–ê–î</button></div>
      <div class="tc af"><div class="tlbl">üåø –î–µ–Ω—å</div><div id="sa"></div><button class="asbtn" onclick="oa('afternoon')">+ –¥–æ–±–∞–≤–∏—Ç—å –ë–ê–î</button></div>
      <div class="tc ev"><div class="tlbl">üåô –í–µ—á–µ—Ä</div><div id="se"></div><button class="asbtn" onclick="oa('evening')">+ –¥–æ–±–∞–≤–∏—Ç—å –ë–ê–î</button></div>
    </div>
    <div class="card">
      <div class="ctitle"><span class="ic">üíß</span>–í–æ–¥–∞ –∑–∞ –¥–µ–Ω—å</div>
      <div class="wrow">
        <div><div class="wnum" id="wn">0 –º–ª</div><div class="wlbl">–∏–∑ 2000 –º–ª</div></div>
        <div class="glasses" id="gls"></div>
      </div>
      <div class="winp">
        <input type="number" id="wiv" placeholder="–º–ª" min="0">
        <button class="btn bp sm" onclick="aw()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="btn bs sm" onclick="rw()">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- SUPPS -->
  <div class="page" id="ps">
    <div class="phdr">
      <div><h2>–ú–æ–∏ –ë–ê–î—ã</h2><p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–∫–∞–º–∏</p></div>
      <button class="btn bp" onclick="om('ms')">+ –î–æ–±–∞–≤–∏—Ç—å –ë–ê–î</button>
    </div>
    <div class="card"><div id="smgr"></div></div>
  </div>

  <!-- DIARY -->
  <div class="page" id="pd">
    <div class="phdr"><div><h2>–î–Ω–µ–≤–Ω–∏–∫ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è</h2><p>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</p></div></div>
    <div class="card dent">
      <div class="ctitle"><span class="ic">‚úèÔ∏è</span>–ó–∞–ø–∏—Å—å ‚Äî <span id="ddl" style="color:var(--sg)"></span></div>
      <div class="mgrid">
        <div class="mb" data-mood="üòÑ" onclick="sm2(this)">üòÑ<span>–û—Ç–ª–∏—á–Ω–æ</span></div>
        <div class="mb" data-mood="üôÇ" onclick="sm2(this)">üôÇ<span>–•–æ—Ä–æ—à–æ</span></div>
        <div class="mb" data-mood="üòê" onclick="sm2(this)">üòê<span>–ù–µ–π—Ç—Ä.</span></div>
        <div class="mb" data-mood="üòî" onclick="sm2(this)">üòî<span>–ü–ª–æ—Ö–æ</span></div>
        <div class="mb" data-mood="üò£" onclick="sm2(this)">üò£<span>–£–∂–∞—Å–Ω–æ</span></div>
      </div>
      <div class="srow"><div class="slbl">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div><div class="sdots" id="se2"></div></div>
      <div class="srow"><div class="slbl">üò¥ –°–æ–Ω</div><div class="sdots" id="ssl"></div></div>
      <div class="swrap">
        <div class="swlbl">–°–∏–º–ø—Ç–æ–º—ã / –∂–∞–ª–æ–±—ã</div>
        <div class="schips" id="sch">
          <div class="sc" onclick="ts(this)">–ì–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å</div>
          <div class="sc" onclick="ts(this)">–£—Å—Ç–∞–ª–æ—Å—Ç—å</div>
          <div class="sc" onclick="ts(this)">–¢–æ—à–Ω–æ—Ç–∞</div>
          <div class="sc" onclick="ts(this)">–ë–æ–ª—å –≤ –∂–∏–≤–æ—Ç–µ</div>
          <div class="sc" onclick="ts(this)">–†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
          <div class="sc" onclick="ts(this)">–ù–∞—Ä—É—à–µ–Ω–∏–µ —Å–Ω–∞</div>
          <div class="sc" onclick="ts(this)">–û—Ç—ë–∫–∏</div>
          <div class="sc" onclick="ts(this)">–ê–ª–ª–µ—Ä–≥–∏—è</div>
        </div>
        <div class="scust"><input id="sci" placeholder="–î—Ä—É–≥–æ–π —Å–∏–º–ø—Ç–æ–º..."><button class="btn bs sm" onclick="acs()">+ –î–æ–±–∞–≤–∏—Ç—å</button></div>
      </div>
      <textarea class="dnote" id="dn" placeholder="–ó–∞–º–µ—Ç–∫–∏ –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏, —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –ë–ê–î—ã..."></textarea>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button class="btn bs sm" onclick="cdf()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button class="btn bp" onclick="sde()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
    <div class="card"><div class="ctitle"><span class="ic">üìú</span>–ò—Å—Ç–æ—Ä–∏—è</div><div id="dh"></div></div>
  </div>

  <!-- GRAPH -->
  <div class="page" id="pg">
    <div class="phdr"><div><h2>–ì—Ä–∞—Ñ–∏–∫</h2><p>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</p></div></div>
    <div class="card">
      <div class="ctitle"><span class="ic">üíä</span>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞</div>
      <div class="gwrap"><div class="gchart" id="gcs"></div></div>
      <div class="leg">
        <div class="li"><div class="ld" style="background:var(--sg)"></div>–í—Å—ë –≤—ã–ø–∏—Ç–æ</div>
        <div class="li"><div class="ld" style="background:var(--gd)"></div>–ß–∞—Å—Ç–∏—á–Ω–æ</div>
        <div class="li"><div class="ld" style="background:#e57373"></div>–ü—Ä–æ–ø—É—Å–∫</div>
      </div>
    </div>
    <div class="card">
      <div class="ctitle"><span class="ic">üíß</span>–í–æ–¥–∞</div>
      <div class="gwrap"><div class="gchart" id="gcw"></div></div>
    </div>
    <div class="card">
      <div class="ctitle"><span class="ic">üòä</span>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
      <div class="gwrap"><div class="gchart" id="gcm"></div></div>
    </div>
  </div>

  <!-- PROFILES -->
  <div class="page" id="pp">
    <div class="phdr"><div><h2>–ü—Ä–æ—Ñ–∏–ª–∏</h2><p>–ß–ª–µ–Ω—ã —Å–µ–º—å–∏</p></div></div>
    <div class="pgrid" id="profg"></div>
  </div>
</main>

<!-- MODALS -->
<div class="mbg" id="mp">
  <div class="modal">
    <h3 id="mpt">–ù–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
    <div class="fr">
      <div class="fg"><label>–§–∞–º–∏–ª–∏—è</label><input id="il" placeholder="–ò–≤–∞–Ω–æ–≤–∞"></div>
      <div class="fg"><label>–ò–º—è</label><input id="if" placeholder="–ê–Ω–Ω–∞"></div>
    </div>
    <div class="fg"><label>–í–æ–∑—Ä–∞—Å—Ç</label><input type="number" id="ia" placeholder="35"></div>
    <div class="fg"><label>PIN-–∫–æ–¥ (4 —Ü–∏—Ñ—Ä—ã)</label><input type="password" id="ip" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" inputmode="numeric"></div>
    <div class="ma">
      <button class="btn bs" onclick="cm('mp')">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn bp" onclick="svp()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<div class="mbg" id="ms">
  <div class="modal">
    <h3>–î–æ–±–∞–≤–∏—Ç—å –ë–ê–î</h3>
    <div class="fg"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input id="isn" placeholder="–í–∏—Ç–∞–º–∏–Ω D3"></div>
    <div class="fr">
      <div class="fg"><label>–§–æ—Ä–º–∞</label>
        <select id="isf"><option value="capsule">–ö–∞–ø—Å—É–ª–∞</option><option value="tablet">–¢–∞–±–ª–µ—Ç–∫–∞</option><option value="powder">–ü–æ—Ä–æ—à–æ–∫</option><option value="drops">–ö–∞–ø–ª–∏</option><option value="other">–î—Ä—É–≥–æ–µ</option></select>
      </div>
      <div class="fg"><label>–ö–æ–ª-–≤–æ</label><input type="number" id="isq" value="1" min="0.5" step="0.5"></div>
    </div>
    <div class="fg"><label>–ï–¥–∏–Ω–∏—Ü–∞</label>
      <select id="isu"><option value="—à—Ç">—à—Ç</option><option value="–º–µ—Ä–Ω–∞—è –ª–æ–∂–∫–∞">–º–µ—Ä–Ω–∞—è –ª–æ–∂–∫–∞</option><option value="–º–ª">–º–ª</option><option value="–∫–∞–ø–ª—è">–∫–∞–ø–ª—è</option><option value="–≥">–≥</option></select>
    </div>
    <div class="ma"><button class="btn bs" onclick="cm('ms')">–û—Ç–º–µ–Ω–∞</button><button class="btn bp" onclick="as2()">–î–æ–±–∞–≤–∏—Ç—å</button></div>
  </div>
</div>

<div class="mbg" id="ma2">
  <div class="modal">
    <h3 id="mat">–î–æ–±–∞–≤–∏—Ç—å –≤ —É—Ç—Ä–æ</h3>
    <div class="fg"><label>–ë–ê–î</label><select id="ias"></select></div>
    <div class="fg"><label>–ö–æ–ª-–≤–æ</label><input type="number" id="iaq" value="1" min="0.5" step="0.5"></div>
    <div class="ma"><button class="btn bs" onclick="cm('ma2')">–û—Ç–º–µ–Ω–∞</button><button class="btn bp" onclick="ca2()">–î–æ–±–∞–≤–∏—Ç—å</button></div>
  </div>
</div>

<div class="mbg" id="mdv">
  <div class="modal wide">
    <h3 id="dvt"></h3>
    <div id="dvc"></div>
    <div class="ma"><button class="btn bd sm" id="dvdb">–£–¥–∞–ª–∏—Ç—å</button><button class="btn bs" onclick="cm('mdv')">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  </div>
</div>

<script>
const SK='badt4';
let S={profiles:[],activeId:null};
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,6)}
function sv(){localStorage.setItem(SK,JSON.stringify(S));syncNow()}
function lv(){try{const r=localStorage.getItem(SK);if(r)S=JSON.parse(r)}catch(e){}}
function gp(){return S.profiles.find(p=>p.id===S.activeId)}
function np(l,f,a,pin){return{id:uid(),lastName:l,firstName:f,age:a,pin:pin||'',supplements:[],days:{},diary:[]}}
function gd(p,k){if(!p.days[k])p.days[k]={morning:[],afternoon:[],evening:[],water:0};return p.days[k]}

// DATE
let cur=new Date();
const MO=['—è–Ω–≤–∞—Ä—è','—Ñ–µ–≤—Ä–∞–ª—è','–º–∞—Ä—Ç–∞','–∞–ø—Ä–µ–ª—è','–º–∞—è','–∏—é–Ω—è','–∏—é–ª—è','–∞–≤–≥—É—Å—Ç–∞','—Å–µ–Ω—Ç—è–±—Ä—è','–æ–∫—Ç—è–±—Ä—è','–Ω–æ—è–±—Ä—è','–¥–µ–∫–∞–±—Ä—è'];
const WD=['–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ','–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–≤—Ç–æ—Ä–Ω–∏–∫','—Å—Ä–µ–¥–∞','—á–µ—Ç–≤–µ—Ä–≥','–ø—è—Ç–Ω–∏—Ü–∞','—Å—É–±–±–æ—Ç–∞'];
function dk2(d){return d.toISOString().slice(0,10)}
function fd2(d){return{big:`${d.getDate()} ${MO[d.getMonth()]} ${d.getFullYear()}`,sub:WD[d.getDay()]}}
function cd(n){cur.setDate(cur.getDate()+n);rt()}
function gt(){cur=new Date();rt()}

// SYNC
let stt=null;
async function syncNow(){
  const p=gp();if(!p||!window._firebaseReady)return;
  setSS('syncing');clearTimeout(stt);
  stt=setTimeout(async()=>{
    const ok=await window._fbSave(p.id,JSON.parse(JSON.stringify(p)));
    setSS(ok?'ok':'err');
  },1200);
}
async function syncLoad(id){
  if(!window._firebaseReady)return null;
  return await window._fbLoad(id);
}
function setSS(s){
  const b=document.getElementById('sb');
  const i=document.getElementById('si');const l=document.getElementById('sl');
  b.className='sync-btn'+(s==='ok'?' ok':s==='err'?' err':'');
  if(s==='syncing'){i.textContent='üîÑ';l.textContent='–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...'}
  if(s==='ok'){i.textContent='‚úÖ';l.textContent='–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ'}
  if(s==='err'){i.textContent='‚ö†Ô∏è';l.textContent='–û—à–∏–±–∫–∞ sync'}
}

// LOCK
let lt2=null,pe='';
function renderLock(){
  const lprofs=document.getElementById('lprofs');
  lprofs.innerHTML='';
  if(!S.profiles.length){
    document.getElementById('lnp').style.display='block';
    document.getElementById('lsel').style.display='none';
    return;
  }
  document.getElementById('lnp').style.display='none';
  document.getElementById('lsel').style.display='block';
  document.getElementById('lpins').style.display='none';
  S.profiles.forEach(p=>{
    const c=document.createElement('div');
    c.className='lpc';
    c.textContent=`${p.firstName} ${p.lastName}`;
    c.onclick=()=>selLP(p,c);
    lprofs.appendChild(c);
  });
}
function selLP(p,el){
  lt2=p;pe='';
  document.querySelectorAll('.lpc').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
  const init=((p.firstName?.[0]||'')+(p.lastName?.[0]||'')).toUpperCase()||'?';
  document.getElementById('lav').textContent=init;
  document.getElementById('lpn').textContent=`${p.firstName} ${p.lastName}`;
  document.getElementById('lpm').textContent=p.age?`${p.age} –ª–µ—Ç`:'';
  upd();
  if(!p.pin){enterApp(p.id);return}
  document.getElementById('lpins').style.display='block';
  document.getElementById('perr').textContent='';
  buildPG();
}
function lockBack(){document.getElementById('lpins').style.display='none';lt2=null;pe=''}
function buildPG(){
  const g=document.getElementById('pgrid');g.innerHTML='';
  [1,2,3,4,5,6,7,8,9,'','0','‚å´'].forEach(n=>{
    const b=document.createElement('button');
    b.className='pb'+(n==='‚å´'?' del':'');
    b.textContent=n;
    if(n===''){b.style.visibility='hidden';b.disabled=true}
    else b.onclick=()=>pp2(n);
    g.appendChild(b);
  });
}
function pp2(n){
  if(n==='‚å´')pe=pe.slice(0,-1);
  else if(pe.length<4)pe+=n;
  upd();
  if(pe.length===4)chkp();
}
function upd(){
  for(let i=0;i<4;i++)document.getElementById('pd'+i).classList.toggle('on',i<pe.length);
}
function chkp(){
  if(pe===lt2.pin){enterApp(lt2.id)}
  else{
    document.getElementById('perr').textContent='–ù–µ–≤–µ—Ä–Ω—ã–π PIN-–∫–æ–¥';
    pe='';upd();
    setTimeout(()=>{document.getElementById('perr').textContent=''},2000);
  }
}
async function enterApp(id){
  S.activeId=id;
  if(window._firebaseReady){
    setSS('syncing');
    const rem=await syncLoad(id);
    if(rem){const idx=S.profiles.findIndex(p=>p.id===id);if(idx!==-1)S.profiles[idx]=rem}
  }
  sv();
  document.getElementById('ls').style.display='none';
  ra();
}
function lockBypass(){
  document.getElementById('ls').style.display='none';
  om('mp');ra();
}

// PROFILES
let epid=null;
function svp(){
  const l=document.getElementById('il').value.trim();
  const f=document.getElementById('if').value.trim();
  const a=parseInt(document.getElementById('ia').value)||null;
  const pin=document.getElementById('ip').value.trim();
  if(!f&&!l)return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—é');
  if(pin&&!/^\d{4}$/.test(pin))return alert('PIN ‚Äî —Ä–æ–≤–Ω–æ 4 —Ü–∏—Ñ—Ä—ã');
  if(epid){
    const p=S.profiles.find(x=>x.id===epid);
    if(p){p.lastName=l;p.firstName=f;p.age=a;if(pin)p.pin=pin}
  }else{
    const p=np(l,f,a,pin);
    S.profiles.push(p);
    if(!S.activeId)S.activeId=p.id;
  }
  epid=null;sv();cm('mp');cpf();ra();renderLock();
}
function delProf(id){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å?'))return;
  S.profiles=S.profiles.filter(p=>p.id!==id);
  if(S.activeId===id)S.activeId=S.profiles[0]?.id||null;
  sv();ra();
}
function swProf(id){
  const p=S.profiles.find(x=>x.id===id);if(!p)return;
  if(p.pin){
    const c=prompt(`PIN-–∫–æ–¥ –¥–ª—è ${p.firstName} ${p.lastName}:`);
    if(c!==p.pin){alert('–ù–µ–≤–µ—Ä–Ω—ã–π PIN');return}
  }
  S.activeId=id;sv();ra();
}
function editProf(id){
  const p=S.profiles.find(x=>x.id===id);if(!p)return;
  epid=id;
  document.getElementById('il').value=p.lastName||'';
  document.getElementById('if').value=p.firstName||'';
  document.getElementById('ia').value=p.age||'';
  document.getElementById('ip').value='';
  document.getElementById('mpt').textContent='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
  om('mp');
}
function cpf(){['il','if','ia','ip'].forEach(i=>document.getElementById(i).value='')}

// SUPPS
function as2(){
  const p=gp();if(!p)return alert('–ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è');
  const n=document.getElementById('isn').value.trim();
  if(!n)return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
  p.supplements.push({id:uid(),name:n,form:document.getElementById('isf').value,
    defaultQty:parseFloat(document.getElementById('isq').value)||1,
    defaultUnit:document.getElementById('isu').value});
  sv();cm('ms');document.getElementById('isn').value='';rss();
}
function ds(id){
  const p=gp();if(!p)return;
  p.supplements=p.supplements.filter(s=>s.id!==id);
  sv();rss();
}

// ASSIGN
let aslot='morning';
function oa(slot){
  const p=gp();if(!p)return alert('–ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è');
  if(!p.supplements.length)return alert('–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –ë–ê–î—ã');
  aslot=slot;
  const tt={morning:'‚òÄÔ∏è –£—Ç—Ä–æ',afternoon:'üåø –î–µ–Ω—å',evening:'üåô –í–µ—á–µ—Ä'};
  document.getElementById('mat').textContent='–î–æ–±–∞–≤–∏—Ç—å –≤ '+tt[slot];
  const sel=document.getElementById('ias');
  sel.innerHTML=p.supplements.map(s=>`<option value="${s.id}">${s.name} (${ff(s.form)})</option>`).join('');
  document.getElementById('iaq').value=p.supplements[0].defaultQty;
  sel.onchange=()=>{const s=p.supplements.find(x=>x.id===sel.value);if(s)document.getElementById('iaq').value=s.defaultQty};
  om('ma2');
}
function ca2(){
  const p=gp();if(!p)return;
  const sid=document.getElementById('ias').value;
  const qty=parseFloat(document.getElementById('iaq').value)||1;
  const day=gd(p,dk2(cur));
  const s=p.supplements.find(x=>x.id===sid);if(!s)return;
  day[aslot].push({suppId:sid,qty,unit:s.defaultUnit,checked:false});
  sv();cm('ma2');rt();
}
function tc2(slot,i){
  const p=gp();if(!p)return;
  const day=gd(p,dk2(cur));
  day[slot][i].checked=!day[slot][i].checked;
  sv();rt();rm();
}
function re(slot,i){
  const p=gp();if(!p)return;
  gd(p,dk2(cur))[slot].splice(i,1);
  sv();rt();
}

// WATER
function aw(){
  const p=gp();if(!p)return;
  const ml=parseInt(document.getElementById('wiv').value)||0;if(ml<=0)return;
  gd(p,dk2(cur)).water=(gd(p,dk2(cur)).water||0)+ml;
  sv();document.getElementById('wiv').value='';rw2();
}
function rw(){
  const p=gp();if(!p)return;
  gd(p,dk2(cur)).water=0;sv();rw2();
}

// MOLODETS
const WORD='–ú–û–õ–û–î–ï–¶';
function gds(p,dkey){
  const day=p.days[dkey];if(!day)return null;
  let tot=0,chk=0;
  ['morning','afternoon','evening'].forEach(s=>(day[s]||[]).forEach(e=>{tot++;if(e.checked)chk++}));
  if(tot===0)return null;
  return{tot,chk,ratio:chk/tot};
}
function cStreak(p){
  const today=new Date();
  let streak=0;
  for(let i=1;i<=365;i++){
    const d=new Date(today);d.setDate(d.getDate()-i);
    const sc=gds(p,dk2(d));
    if(sc&&sc.ratio>=1.0)streak++;
    else break;
  }
  const tsc=gds(p,dk2(today));
  const tdone=tsc&&tsc.ratio>=1.0;
  return{streak,tdone,letters:Math.min(streak+(tdone?1:0),7)};
}
function rm(){
  const p=gp();
  const track=document.getElementById('mt');
  const info=document.getElementById('msi');
  const reset=document.getElementById('msr');
  track.innerHTML='';info.textContent='';reset.textContent='';
  if(!p)return;
  const{streak,tdone,letters}=cStreak(p);
  WORD.split('').forEach((letter,i)=>{
    const c=document.createElement('div');
    c.className='mc'+(i<letters?' un':i===letters?' cur':'');
    c.textContent=letter;track.appendChild(c);
  });
  if(letters===7)info.innerHTML='üéâ <strong>–ú–û–õ–û–î–ï–¶!</strong> –°–ª–æ–≤–æ —Å–æ–±—Ä–∞–Ω–æ! –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ü–∏–∫–ª.';
  else info.innerHTML=`–ü–æ–¥—Ä—è–¥: <strong>${letters}</strong> –∏–∑ 7`;
  if(streak>0&&!tdone)reset.textContent='‚ö†Ô∏è –°–µ–≥–æ–¥–Ω—è –Ω–µ –≤—Å—ë –æ—Ç–º–µ—á–µ–Ω–æ ‚Äî —Å–µ—Ä–∏—è –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è';
}

// DIARY
let dmood=null,denergy=0,dsleep=0;
const MOODS={'üòÑ':5,'üôÇ':4,'üòê':3,'üòî':2,'üò£':1};
function bsd(cid,max,cb,cv){
  const c=document.getElementById(cid);c.innerHTML='';
  for(let i=1;i<=max;i++){
    const d=document.createElement('div');
    d.className='sd'+(i<=cv?' sel':'');
    d.textContent=i;
    d.onclick=()=>{cb(i);bsd(cid,max,cb,i)};
    c.appendChild(d);
  }
}
function idf(){
  bsd('se2',10,v=>{denergy=v},denergy);
  bsd('ssl',10,v=>{dsleep=v},dsleep);
}
function sm2(el){document.querySelectorAll('.mb').forEach(b=>b.classList.remove('sel'));el.classList.add('sel');dmood=el.dataset.mood}
function ts(el){el.classList.toggle('sel')}
function acs(){
  const inp=document.getElementById('sci');const v=inp.value.trim();if(!v)return;
  const c=document.createElement('div');c.className='sc sel';c.textContent=v;c.onclick=()=>ts(c);
  document.getElementById('sch').appendChild(c);inp.value='';
}
function cdf(){
  dmood=null;denergy=0;dsleep=0;
  document.querySelectorAll('.mb').forEach(b=>b.classList.remove('sel'));
  document.querySelectorAll('.sc').forEach(b=>b.classList.remove('sel'));
  document.getElementById('dn').value='';idf();
}
function sde(){
  const p=gp();if(!p)return alert('–ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è');
  const symp=[...document.querySelectorAll('.sc.sel')].map(c=>c.textContent);
  const note=document.getElementById('dn').value.trim();
  if(!dmood&&!note&&!symp.length&&!denergy&&!dsleep)return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ª–µ');
  const entry={id:uid(),date:dk2(cur),mood:dmood,energy:denergy,sleep:dsleep,symptoms:symp,note,ts2:Date.now()};
  if(!p.diary)p.diary=[];
  const ei=p.diary.findIndex(e=>e.date===dk2(cur));
  if(ei!==-1){if(!confirm('–ó–∞–ø–∏—Å—å –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å —É–∂–µ –µ—Å—Ç—å. –ó–∞–º–µ–Ω–∏—Ç—å?'))return;p.diary[ei]=entry}
  else p.diary.push(entry);
  sv();cdf();rdh();alert('–ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
}
function rdh(){
  const p=gp();const c=document.getElementById('dh');
  if(!p||!p.diary||!p.diary.length){c.innerHTML=`<div class="empty"><div class="em">üìì</div><p>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</p></div>`;return}
  const sorted=[...p.diary].sort((a,b)=>b.ts2-a.ts2);
  c.innerHTML=sorted.map(e=>`
    <div class="dhi" onclick="vd('${e.id}')">
      <div class="dht"><div class="dhd">${fds(e.date)}</div><div class="dhm">${e.mood||'‚Äî'}</div></div>
      ${e.note?`<div class="dhtxt">${e.note}</div>`:''}
      ${e.symptoms?.length?`<div class="dhtags">${e.symptoms.map(s=>`<span class="mt">${s}</span>`).join('')}</div>`:''}
    </div>
  `).join('');
}
function vd(id){
  const p=gp();if(!p)return;
  const e=p.diary?.find(x=>x.id===id);if(!e)return;
  document.getElementById('dvt').textContent=fds(e.date);
  document.getElementById('dvc').innerHTML=`
    <div style="display:flex;gap:16px;margin-bottom:14px;flex-wrap:wrap">
      ${e.mood?`<div><div style="font-size:36px">${e.mood}</div><div style="font-size:12px;color:var(--md)">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div></div>`:''}
      ${e.energy?`<div><div style="font-size:22px;font-family:'Playfair Display',serif;font-weight:700;color:var(--gd)">${e.energy}/10</div><div style="font-size:12px;color:var(--md)">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div></div>`:''}
      ${e.sleep?`<div><div style="font-size:22px;font-family:'Playfair Display',serif;font-weight:700;color:var(--sk)">${e.sleep}/10</div><div style="font-size:12px;color:var(--md)">üò¥ –°–æ–Ω</div></div>`:''}
    </div>
    ${e.symptoms?.length?`<div style="margin-bottom:12px"><div style="font-size:11px;font-weight:700;color:var(--md);text-transform:uppercase;letter-spacing:.8px;margin-bottom:6px">–°–∏–º–ø—Ç–æ–º—ã</div><div style="display:flex;flex-wrap:wrap;gap:5px">${e.symptoms.map(s=>`<span class="mt">${s}</span>`).join('')}</div></div>`:''}
    ${e.note?`<div style="background:rgba(255,255,255,.7);border-radius:12px;padding:12px;font-size:13px;line-height:1.6">${e.note}</div>`:''}
  `;
  document.getElementById('dvdb').onclick=()=>{
    if(confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')){p.diary=p.diary.filter(x=>x.id!==id);sv();cm('mdv');rdh()}
  };
  om('mdv');
}
function fds(ds){const d=new Date(ds+'T00:00:00');return`${d.getDate()} ${MO[d.getMonth()]} ${d.getFullYear()}`}

// RENDER
const FM={capsule:'–ö–∞–ø—Å—É–ª–∞',tablet:'–¢–∞–±–ª–µ—Ç–∫–∞',powder:'–ü–æ—Ä–æ—à–æ–∫',drops:'–ö–∞–ø–ª–∏',other:'–î—Ä—É–≥–æ–µ'};
function ff(f){return FM[f]||f}
function ra(){rch();rt();rss();rpp();rg();rdh();idf();const p=gp();if(p)document.getElementById('ddl').textContent=fd2(cur).big}
function rch(){
  const c=document.getElementById('pchips');c.innerHTML='';
  S.profiles.forEach(p=>{
    const init=((p.firstName?.[0]||'')+(p.lastName?.[0]||'')).toUpperCase()||'?';
    const el=document.createElement('div');
    el.className='pchip'+(p.id===S.activeId?' act':'');
    el.innerHTML=`<div class="chav">${init}</div>${p.firstName||p.lastName}`;
    el.onclick=()=>swProf(p.id);
    c.appendChild(el);
  });
}
function rt(){
  const fd=fd2(cur);
  document.getElementById('dbig').textContent=fd.big;
  document.getElementById('ddsub').textContent=fd.sub;
  document.getElementById('ddl').textContent=fd.big;
  const p=gp();
  document.getElementById('tsub').textContent=p?`${p.firstName} ${p.lastName}`:'–ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è';
  ['morning','afternoon','evening'].forEach((slot,si)=>{
    const ids=['sm','sa','se'];const cont=document.getElementById(ids[si]);
    cont.innerHTML='';if(!p){return}
    const day=gd(p,dk2(cur));const entries=day[slot]||[];
    if(!entries.length){cont.innerHTML=`<div style="text-align:center;padding:14px;color:var(--mu);font-size:12px">–ù–µ—Ç –ë–ê–î–æ–≤</div>`;return}
    entries.forEach((e,i)=>{
      const s=p.supplements.find(x=>x.id===e.suppId);if(!s)return;
      const d=document.createElement('div');d.className='si';
      d.innerHTML=`
        <div class="sl"><span class="fb ${s.form}">${ff(s.form)}</span><span class="sn">${s.name}</span></div>
        <span class="sq">${e.qty} ${e.unit}</span>
        <button class="ck${e.checked?' on':''}" onclick="tc2('${slot}',${i})">${e.checked?'‚úì':''}</button>
        <button class="rb" onclick="re('${slot}',${i})">√ó</button>
      `;
      cont.appendChild(d);
    });
  });
  rw2();rm();
}
function rw2(){
  const p=gp();const day=p?gd(p,dk2(cur)):null;const ml=day?(day.water||0):0;
  document.getElementById('wn').textContent=ml+' –º–ª';
  const gc=document.getElementById('gls');gc.innerHTML='';
  for(let i=0;i<8;i++){
    const g=document.createElement('div');
    g.className='gl'+(ml>=(i+1)*250?' on':'');
    g.title=`${(i+1)*250} –º–ª`;
    g.onclick=()=>{if(!p)return;gd(p,dk2(cur)).water=(i+1)*250;sv();rw2()};
    gc.appendChild(g);
  }
}
function rss(){
  const p=gp();const c=document.getElementById('smgr');
  if(!p){c.innerHTML=`<div class="empty"><div class="em">üë§</div><p>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</p></div>`;return}
  if(!p.supplements.length){c.innerHTML=`<div class="empty"><div class="em">üíä</div><p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ë–ê–î</p></div>`;return}
  c.innerHTML=p.supplements.map(s=>`
    <div class="sr">
      <div class="sri"><div class="sn2">${s.name}</div><div class="sd2">${ff(s.form)} ¬∑ ${s.defaultQty} ${s.defaultUnit}</div></div>
      <span class="fb ${s.form}">${ff(s.form)}</span>
      <button class="btn bd sm" onclick="ds('${s.id}')">–£–¥–∞–ª–∏—Ç—å</button>
    </div>
  `).join('');
}
function rpp(){
  const g=document.getElementById('profg');g.innerHTML='';
  S.profiles.forEach(p=>{
    const init=((p.firstName?.[0]||'')+(p.lastName?.[0]||'')).toUpperCase()||'?';
    const c=document.createElement('div');
    c.className='pc'+(p.id===S.activeId?' iact':'');
    c.innerHTML=`
      <div class="bav">${init}</div>
      <div class="pname">${p.firstName} ${p.lastName}</div>
      <div class="pmeta">${p.age?p.age+' –ª–µ—Ç':''}${p.pin?' ¬∑ üîí PIN':''}</div>
      <div class="pac">
        <button class="btn bp sm" onclick="swProf('${p.id}')">–í–æ–π—Ç–∏</button>
        <button class="btn bs sm" onclick="editProf('${p.id}')">‚úèÔ∏è</button>
        <button class="btn bd sm" onclick="delProf('${p.id}')">üóëÔ∏è</button>
      </div>
    `;g.appendChild(c);
  });
  const add=document.createElement('div');
  add.className='pc apc';add.onclick=()=>om('mp');
  add.innerHTML=`<div class="bav">+</div><div class="pname">–ù–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å</div><div class="pmeta">–î–æ–±–∞–≤–∏—Ç—å</div>`;
  g.appendChild(add);
}
function rg(){
  const p=gp();
  ['gcs','gcw','gcm'].forEach(id=>document.getElementById(id).innerHTML='');
  if(!p)return;
  const days=[];for(let i=29;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);days.push(d)}
  const mH=120;
  days.forEach(d=>{
    const dkey=dk2(d);const day=p.days[dkey];
    const lbl=`${d.getDate()}.${String(d.getMonth()+1).padStart(2,'0')}`;
    // supps
    let tot=0,chk=0;
    if(day)['morning','afternoon','evening'].forEach(s=>(day[s]||[]).forEach(e=>{tot++;if(e.checked)chk++}));
    let cls='mt',pct=0,l2='‚Äì';
    if(tot>0){pct=Math.round(chk/tot*100);cls=chk===tot?'good':chk>0?'part':'miss';l2=pct+'%'}
    const sh=tot>0?Math.max(6,Math.round(pct/100*mH)):4;
    const sc=document.createElement('div');sc.className='bc';sc.title=`${lbl}: ${tot>0?chk+'/'+tot:'–Ω–µ—Ç'}`;
    sc.innerHTML=`<div class="bl">${l2}</div><div class="bv ${cls}" style="height:${sh}px"></div><div class="bdate">${lbl}</div>`;
    document.getElementById('gcs').appendChild(sc);
    // water
    const w=day?.water||0;const wh=w>0?Math.max(5,Math.round(w/2000*mH)):4;
    const wc=document.createElement('div');wc.className='bc';wc.title=`${lbl}: ${w}–º–ª`;
    wc.innerHTML=`<div class="bl" style="color:var(--sk)">${w>0?w+'–º–ª':'‚Äì'}</div><div class="bv" style="height:${wh}px;background:linear-gradient(to top,#2980b9,#85c1e9)"></div><div class="bdate">${lbl}</div>`;
    document.getElementById('gcw').appendChild(wc);
    // mood
    const de=p.diary?.find(e=>e.date===dkey);const ms=de?.mood?MOODS[de.mood]||0:0;
    const mh2=ms>0?Math.max(6,Math.round(ms/5*mH)):4;
    const mc2={5:'#6b9e6f',4:'#a8c9ab',3:'#c9993a',2:'#e57373',1:'#c0392b'};
    const mc=document.createElement('div');mc.className='bc';mc.title=`${lbl}: ${de?.mood||'‚Äì'}`;
    mc.innerHTML=`<div class="bl">${de?.mood||'‚Äì'}</div><div class="bv" style="height:${mh2}px;background:${mc2[ms]||'rgba(181,169,154,.2)'}"></div><div class="bdate">${lbl}</div>`;
    document.getElementById('gcm').appendChild(mc);
  });
}

// UI
function sp(id,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('act'));
  document.getElementById(id).classList.add('act');
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('act'));
  if(el)el.classList.add('act');
  if(id==='pg')rg();if(id==='pd'){rdh();idf()}if(id==='ps')rss();if(id==='pp')rpp();
}
function om(id){document.getElementById(id).classList.add('open')}
function cm(id){
  document.getElementById(id).classList.remove('open');
  if(id==='mp'){epid=null;document.getElementById('mpt').textContent='–ù–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å';cpf()}
}
document.querySelectorAll('.mbg').forEach(b=>b.addEventListener('click',e=>{if(e.target===b)b.classList.remove('open')}));

// INIT
lv();renderLock();
</script>
</body>
</html>
